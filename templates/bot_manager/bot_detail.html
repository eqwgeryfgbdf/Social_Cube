{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ bot.name }} - {% trans "Bot Management" %}{% endblock %}

{% block extra_css %}
<style>
:root {
    --tab-height: 3rem;
    --card-radius: 0.75rem;
    --transition-speed: 0.3s;
    
    /* Updated color variables for better contrast */
    --text-primary: #1e293b;    /* Dark blue-black for primary text */
    --text-secondary: #4b5563;  /* Medium gray for secondary text */
    --text-tertiary: #64748b;   /* Lighter gray for tertiary text */
    --text-light: #f8fafc;      /* Light gray for dark backgrounds */
    --purple-dark: #7c3aed;     /* Dark purple for emphasis */
    --status-active: #15803d;   /* Darker green for active status */
    --status-inactive: #dc2626; /* Darker red for inactive status */
}

.bot-detail-container {
    padding: 2rem 1.5rem;
    max-width: 1440px;
    margin: 0 auto;
}

/* Bot Header */
.bot-header {
    background: white;
    border-radius: var(--card-radius);
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(27, 91, 126, 0.1);
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 2rem;
    align-items: center;
}

.bot-avatar {
    width: 6rem;
    height: 6rem;
    border-radius: 1.5rem;
    background: var(--color-1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: var(--color-5);
    box-shadow: 0 4px 6px rgba(27, 91, 126, 0.1);
}

.bot-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.bot-name {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.bot-platform {
    font-size: 1rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.bot-stats {
    display: flex;
    gap: 1.5rem;
    margin-top: 0.5rem;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.stat-item i {
    font-size: 1rem;
    color: var(--text-tertiary);
}

.bot-actions {
    display: flex;
    gap: 1rem;
}

.btn-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all var(--transition-speed) ease;
    border: none;
    cursor: pointer;
}

.btn-action.primary {
    background: var(--color-4);
    color: white;
}

.btn-action.primary:hover {
    background: var(--color-5);
    transform: translateY(-2px);
}

.btn-action.danger {
    background: #dc3545;
    color: white;
}

.btn-action.danger:hover {
    background: #c82333;
    transform: translateY(-2px);
}

/* Tabs Navigation */
.bot-tabs {
    background: white;
    border-radius: var(--card-radius);
    padding: 0 1rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 4px rgba(27, 91, 126, 0.1);
}

.nav-tabs {
    display: flex;
    gap: 1rem;
    border: none;
    padding: 0;
    margin: 0;
    list-style: none;
}

.nav-tabs .nav-item {
    margin: 0;
}

.nav-tabs .nav-link {
    height: var(--tab-height);
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-weight: 500;
    border: none;
    border-bottom: 2px solid transparent;
    transition: all var(--transition-speed) ease;
    background: transparent;
}

.nav-tabs .nav-link i {
    font-size: 1.125rem;
}

.nav-tabs .nav-link:hover {
    color: var(--text-primary);
}

.nav-tabs .nav-link.active {
    color: var(--purple-dark);
    border-color: var(--purple-dark);
    font-weight: 600;
}

/* Tab Content */
.tab-content {
    background: white;
    border-radius: var(--card-radius);
    padding: 2rem;
    box-shadow: 0 2px 4px rgba(27, 91, 126, 0.1);
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

/* Server Management */
.server-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.server-card {
    background: white;
    border: 1px solid var(--color-1);
    border-radius: var(--card-radius);
    padding: 1.5rem;
    transition: all var(--transition-speed) ease;
}

.server-card:hover {
    border-color: var(--color-3);
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(27, 91, 126, 0.1);
}

.server-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.server-name {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.server-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.server-stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.server-stat i {
    color: var(--text-tertiary);
}

.channel-list {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-1);
}

.channel-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.channel-name {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.channel-type {
    color: var(--text-tertiary);
    font-size: 0.75rem;
}

/* Settings Form */
.settings-form {
    max-width: 600px;
    margin: 0 auto;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-primary);
}

.form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--color-1);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all var(--transition-speed) ease;
}

.form-control:focus {
    border-color: var(--color-3);
    box-shadow: 0 0 0 2px rgba(74, 154, 176, 0.1);
    outline: none;
}

.form-text {
    margin-top: 0.375rem;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

/* Logs Section */
.log-container {
    background: #f8fafc;
    border-radius: 0.5rem;
    padding: 1rem;
    max-height: 400px;
    overflow-y: auto;
}

.log-entry {
    padding: 0.5rem;
    font-family: monospace;
    font-size: 0.875rem;
    border-bottom: 1px solid var(--color-1);
}

.log-entry:last-child {
    border-bottom: none;
}

.log-time {
    color: var(--text-tertiary);
    margin-right: 0.5rem;
}

.log-level {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
    margin-right: 0.5rem;
}

.log-level.info {
    background: rgba(124, 58, 237, 0.1);
    color: var(--purple-dark);
}

.log-level.error {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

.log-message {
    color: var(--text-primary);
}

/* Status Badges */
.bot-status {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.bot-status.active {
    background-color: rgba(21, 128, 61, 0.1);
    color: var(--status-active);
}

.bot-status.inactive {
    background-color: rgba(220, 38, 38, 0.1);
    color: var(--status-inactive);
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: 2rem;
    border-radius: var(--card-radius);
    background-color: var(--text-light);
    box-shadow: 0 2px 4px rgba(27, 91, 126, 0.1);
}

.empty-state h3 {
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
}

.empty-state-icon {
    color: var(--purple-dark);
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

/* Footer - assuming dark background */
.footer {
    color: var(--text-light);
}

.footer a {
    color: var(--text-light);
    opacity: 0.9;
}

.footer a:hover {
    opacity: 1;
}

@media (max-width: 768px) {
    .bot-header {
        grid-template-columns: 1fr;
        gap: 1rem;
        text-align: center;
    }

    .bot-avatar {
        margin: 0 auto;
    }

    .bot-stats {
        justify-content: center;
    }

    .bot-actions {
        justify-content: center;
    }

    .nav-tabs {
        overflow-x: auto;
        padding-bottom: 0.5rem;
    }

    .nav-tabs .nav-link {
        padding: 0 1rem;
        white-space: nowrap;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="bot-detail-container">
    <!-- Bot Header -->
    <div class="bot-header">
        <div class="bot-avatar">
            <i class="fas fa-robot"></i>
        </div>
        <div class="bot-info">
            <h1 class="bot-name">
                {{ bot.name }}
                <span class="bot-status {% if bot.is_active %}active{% else %}inactive{% endif %}">
                    <span class="status-dot"></span>
                    {% if bot.is_active %}{% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}
                </span>
            </h1>
            <div class="bot-platform">
                <i class="fas fa-globe"></i>
                {{ bot.platform }}
            </div>
            <div class="bot-stats">
                <div class="stat-item">
                    <i class="fas fa-server"></i>
                    <span>{{ bot.server_count }} {% trans "Servers" %}</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span>{{ bot.user_count }} {% trans "Users" %}</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-terminal"></i>
                    <span>{{ bot.command_count }} {% trans "Commands" %}</span>
                </div>
            </div>
        </div>
        <div class="bot-actions">
            <form action="{% url 'bot_toggle' bot.id %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-action {% if bot.is_active %}danger{% else %}primary{% endif %}">
                    <i class="fas {% if bot.is_active %}fa-stop{% else %}fa-play{% endif %}"></i>
                    {% if bot.is_active %}{% trans "Stop" %}{% else %}{% trans "Start" %}{% endif %}
                </button>
            </form>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="bot-tabs">
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#servers" role="tab">
                    <i class="fas fa-server"></i>
                    {% trans "Servers" %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#commands" role="tab">
                    <i class="fas fa-terminal"></i>
                    {% trans "Commands" %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#settings" role="tab">
                    <i class="fas fa-cog"></i>
                    {% trans "Settings" %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#logs" role="tab">
                    <i class="fas fa-list"></i>
                    {% trans "Logs" %}
                </a>
            </li>
        </ul>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Servers Tab -->
        <div class="tab-pane active" id="servers">
            <div class="server-grid">
                {% for server in bot.servers.all %}
                <div class="server-card">
                    <div class="server-header">
                        <h3 class="server-name">{{ server.name }}</h3>
                        <div class="server-status {% if server.is_active %}active{% else %}inactive{% endif %}">
                            <span class="status-dot"></span>
                        </div>
                    </div>
                    <div class="server-info">
                        <div class="server-stat">
                            <i class="fas fa-users"></i>
                            <span>{{ server.member_count }} {% trans "Members" %}</span>
                        </div>
                        <div class="server-stat">
                            <i class="fas fa-hashtag"></i>
                            <span>{{ server.channel_count }} {% trans "Channels" %}</span>
                        </div>
                    </div>
                    <div class="channel-list">
                        {% for channel in server.channels.all|slice:":3" %}
                        <div class="channel-item">
                            <div class="channel-name">
                                <i class="fas {% if channel.type == 'text' %}fa-hashtag{% else %}fa-volume-up{% endif %}"></i>
                                {{ channel.name }}
                            </div>
                            <span class="channel-type">{{ channel.type }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <h3>{% trans "No Servers Connected" %}</h3>
                    <p>{% trans "Add this bot to a server to get started." %}</p>
                    <a href="#" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        {% trans "Add to Server" %}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Commands Tab -->
        <div class="tab-pane" id="commands">
            <div class="commands-list">
                {% for command in bot.commands.all %}
                <div class="command-item">
                    <div class="command-header">
                        <h3 class="command-name">{{ command.name }}</h3>
                        <span class="command-category">{{ command.category }}</span>
                    </div>
                    <p class="command-description">{{ command.description }}</p>
                    <div class="command-usage">
                        <code>{{ command.usage }}</code>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-terminal"></i>
                    </div>
                    <h3>{% trans "No Commands Configured" %}</h3>
                    <p>{% trans "Add commands to enable bot functionality." %}</p>
                    <a href="#" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        {% trans "Add Command" %}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-pane" id="settings">
            <form class="settings-form">
                <div class="form-group">
                    <label class="form-label">{% trans "Bot Name" %}</label>
                    <input type="text" class="form-control" value="{{ bot.name }}">
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Description" %}</label>
                    <textarea class="form-control" rows="3">{{ bot.description }}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">{% trans "Prefix" %}</label>
                    <input type="text" class="form-control" value="{{ bot.prefix }}">
                    <div class="form-text">{% trans "The character(s) that trigger bot commands" %}</div>
                </div>
                <button type="submit" class="btn-action primary">
                    <i class="fas fa-save"></i>
                    {% trans "Save Changes" %}
                </button>
            </form>
        </div>

        <!-- Logs Tab -->
        <div class="tab-pane" id="logs">
            <div class="log-container">
                {% for log in bot.logs.all %}
                <div class="log-entry">
                    <span class="log-time">{{ log.timestamp|date:"Y-m-d H:i:s" }}</span>
                    <span class="log-level {{ log.level }}">{{ log.level }}</span>
                    <span class="log-message">{{ log.message }}</span>
                </div>
                {% empty %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <h3>{% trans "No Logs Available" %}</h3>
                    <p>{% trans "Bot activity logs will appear here." %}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %} 